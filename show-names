#!/bin/bash

baseIP="192.168.122."

START_IP=""
END_IP=""
DEFAULT_START_IP="101"
DEFAULT_END_IP="103"

function showHelp() {
  echo "Usage: $0 [options]"
  echo "Options:"
  echo "  -s, --start-ip <octet>   Set start IP (last octet)"
  echo "  -e, --end-ip <octet>     Set end IP (last octet)"
  echo "  -b, --base-ip <base>     Set base IP (default: 192.168.122.)"
  echo "  -h, --help               Show this help message"
  exit 0
}

while [[ $# -gt 0 ]]; do
  case "$1" in
    -s|--start-ip)
      START_IP="$2"
      shift 2
      ;;
    -e|--end-ip)
      END_IP="$2"
      shift 2
      ;;
    -b|--base-ip)
      baseIP="$2"
      shift 2
      ;;
    -h|--help)
      showHelp
      ;;
    *)
      echo "Unknown option: $1"
      showHelp
      ;;
  esac
done

function promptIfMissing() {
  value=$1
  prompt=$2
  defaultValue=$3
  hidden=$4

  # Early return if value already provided
  if [ -n "${value}" ]; then
    echo "${value}"
    return 0
  fi

  # Handle hidden input (password-style)
  if [ "${hidden}" = true ]; then
    read -rsp "${prompt}" tmpvar
    echo "${tmpvar}"
    return 0
  fi

  # Add default value to prompt if provided
  if [ -n "${defaultValue}" ]; then
    prompt="${prompt} (${defaultValue})"
  fi

  read -rp "${prompt}" tmpvar

  # Return default if no input and default exists
  if [[ -z "${tmpvar}" && -n "${defaultValue}" ]]; then
    echo "${defaultValue}"
    return 0
  fi

  echo "${tmpvar}"
  return 0
}

START_IP=$(promptIfMissing "${START_IP}" "Start IP (last octet): " "${DEFAULT_START_IP}")
END_IP=$(promptIfMissing "${END_IP}" "End IP (last octet): " "${DEFAULT_END_IP}")

if [ -z "${START_IP}" ] || [ -z "${END_IP}" ]; then
  echo "Start and End IP are required!"
  exit 1
fi

for (( ip=${START_IP}; ip<=${END_IP}; ip++ )); do
  ssh -i ~/.ssh/id_rsa "jdarling@${baseIP}${ip}" "echo -n '${baseIP}${ip}: ' && hostname && exit"
done
